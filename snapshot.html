<!DOCTYPE html><html lang="en"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 34.1.4">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
  
  
  
  
  
<script>document.title = respecConfig.title</script>
<title>OGC API Features Guideline</title>
  
<title>Default</title>
  
<link rel="shortcut icon" type="image/x-icon" href="https://tools.geostandaarden.nl/respec/style/logos/Geonovum.ico">
  

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline;position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-.7em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<style id="respec-nlgov">
img.license{float:left;padding-right:5px}
</style>
<meta name="description" content="This document is a guideline for Dutch data providers who want to use OGC-API-Features for download services in a way that they comply with relevant standards.
The guideline has been written on the basis of the experiences gained from implementations of OGC-API-Features of INSPIRE datasets on test beds.
A second important basis is formed by the results of an open tender, held in the beginning of 2023. 
This tender aimed at adjusting tools for serving OGC-API-feature services to 3 standards: OGC, Dutch Application Design Rules and INSPIRE. Until this tender, no tools were known that comply with all these standards.
This guideline describes the requirements, as set out by the standards and uses the demo services from this open tender as an example of how one can comply with the standards.
The aim of setting up these test beds and this guideline, has been to stimulate the Dutch data providers and hosting organizations to start publishing data as OGC API Features.
By doing this, a greater goal is reached: A better use of geospatial data.">
<style>

  .sidelabel {
    position: fixed;
    -webkit-transform-origin: top right;
    right: 100%;
    top: 0;
    -webkit-transform: rotate(-90deg);
    padding: 4px 50px 4px 10px;
    color: white;
    white-space: nowrap;
    z-index: 1;
    background-color: #FF0000;
  }
</style>
<script type="text/javascript">
   /* Any custom mermaid.js scripts will go here. */
  </script>
<style>

  /* Any custom mermaid.js scripts will go here. */
  }
</style>
<script id="initialUserConfig" type="application/json">{
  "nl_organisationName": "Geonovum",
  "nl_organisationPublishURL": "https://docs.geostandaarden.nl/",
  "logos": [
    {
      "src": "https://tools.geostandaarden.nl/respec/style/logos/Geonovum.svg",
      "alt": "Geonovum",
      "id": "Geonovum",
      "height": 67,
      "width": 132,
      "url": "https://www.geonovum.nl/geo-standaarden"
    }
  ],
  "postProcess": [
    null
  ],
  "latestVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "shortName",
    "/"
  ],
  "thisVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "specStatus",
    "-",
    "specType",
    "-",
    "shortName",
    "-",
    "publishDate"
  ],
  "prevVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "previousMaturity",
    "-",
    "specType",
    "-",
    "shortName",
    "-",
    "previousPublishDate"
  ],
  "useLogo": true,
  "useLabel": true,
  "license": "cc-by",
  "addSectionLinks": true,
  "localizationStrings": {
    "en": {
      "wv": "Editor's draft",
      "cv": "Candidate recommendation",
      "vv": "Proposed recommendation",
      "def": "Recommendation",
      "ld": "Living document",
      "basis": "Document",
      "no": "Norm",
      "st": "Standard",
      "im": "Information model",
      "pr": "Practical guideline",
      "hr": "Guide",
      "wa": "Work process agreement",
      "al": "General",
      "bd": "Governance documentation",
      "bp": "Best practice"
    },
    "nl": {
      "wv": "Werkversie",
      "cv": "Consultatieversie",
      "vv": "Versie ter vaststelling",
      "def": "Vastgestelde versie",
      "ld": "Levend document",
      "basis": "Document",
      "no": "Norm",
      "st": "Standaard",
      "im": "Informatiemodel",
      "pr": "Praktijkrichtlijn",
      "hr": "Handreiking",
      "wa": "Werkafspraak",
      "al": "Algemeen",
      "bd": "Beheerdocumentatie",
      "bp": "Best practice"
    }
  },
  "sotdText": {
    "nl": {
      "sotd": "Status van dit document",
      "def": "Dit is de definitieve versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
      "wv": "Dit is een werkversie die op elk moment kan worden gewijzigd, verwijderd of vervangen door andere documenten. Het is geen stabiel document.",
      "cv": "Dit is een consultatieversie. Commentaar over dit document kan gestuurd worden naar ",
      "vv": "Dit is de definitieve conceptversie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
      "basis": "Dit is een document zonder officiële status.",
      "ld": "Dit is een levend document dat regelmatig gewijzigd wordt."
    },
    "en": {
      "sotd": "Status of this document",
      "def": "This is the definitive version of this document. Edits resulting from consultations have been applied.",
      "wv": "This is a working draft that can be changed, removed or replaced by other documents at any time. It is not a stable document.",
      "cv": "This is a stable draft, published for public comment. Comments regarding this document may be sent to ",
      "vv": "This is the final draft of this document. Edits resulting from consultations have been applied.",
      "basis": "This document has no official standing.",
      "ld": "This is a living document, which is updated regularly."
    }
  },
  "labelColor": {
    "def": "#045D9F",
    "wv": "#FF0000",
    "cv": "#045D9F",
    "vv": "#045D9F",
    "basis": "#80CC28",
    "ld": "#80CC28"
  },
  "licenses": {
    "cc0": {
      "name": "Creative Commons 0 Public Domain Dedication",
      "short": "CC0",
      "url": "https://creativecommons.org/publicdomain/zero/1.0/",
      "image": "https://tools.geostandaarden.nl/respec/style/logos/CC-Licentie.svg"
    },
    "cc-by": {
      "name": "Creative Commons Attribution 4.0 International Public License",
      "short": "CC-BY",
      "url": "https://creativecommons.org/licenses/by/4.0/legalcode",
      "image": "https://tools.geostandaarden.nl/respec/style/logos/cc-by.svg"
    },
    "cc-by-nd": {
      "name": "Creative Commons Naamsvermelding-GeenAfgeleideWerken 4.0 Internationaal",
      "short": "CC-BY-ND",
      "url": "https://creativecommons.org/licenses/by-nd/4.0/legalcode.nl",
      "image": "https://tools.geostandaarden.nl/respec/style/logos/cc-by-nd.svg"
    }
  },
  "localBiblio": {
    "PUB-1": {
      "title": "OGC API Features Part1:Core",
      "href": "https://docs.opengeospatial.org/is/17-069r4/17-069r4.html",
      "status": "V1.0",
      "publisher": "OGC",
      "company": "OGC",
      "id": "pub-1"
    },
    "PUB-2": {
      "title": "Setting up an INSPIRE Download service based on the OGC API-Features standard",
      "href": "https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md",
      "status": "V1.0",
      "publisher": "INSPIRE-MIF",
      "company": "Companynaam",
      "id": "pub-2"
    },
    "PUB-3": {
      "title": "Dutch API design rules",
      "href": "https://www.geonovum.nl/over-geonovum/actueel/rest-api-design-rules-op-pas-toe-leg-uit-lijst",
      "status": "19 JULI 2020",
      "publisher": "https://www.geonovum.nl",
      "company": "Geonovum",
      "id": "pub-3"
    },
    "PUB-4": {
      "title": "INSPIRE UML-to-GeoJSON encoding rule",
      "href": "https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/geojson-encoding-rule.md#inspire-requirements-for-encoding-rules",
      "status": "V0.1",
      "publisher": "Working group on Inspire Action 2017.2",
      "company": "Companynaam",
      "id": "pub-4"
    },
    "PUB-5": {
      "title": "OGC API - Features - Part 2: Coordinate Reference Systems by Reference",
      "href": "http://docs.opengeospatial.org/is/18-058r1/18-058r1.html",
      "status": "V1.0",
      "publisher": "OGC",
      "company": "OGC",
      "id": "pub-5"
    },
    "PUB-6": {
      "title": "OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)",
      "href": "https://docs.ogc.org/DRAFTS/19-079r1.html",
      "status": "V1.0.0, draft",
      "publisher": "OGC",
      "company": "OGC",
      "id": "pub-6"
    }
  },
  "title": "OGC API Features Guideline",
  "specStatus": "wv",
  "specType": "HR",
  "pubDomain": "dk",
  "licence": "cc-by",
  "shortName": "OGC API Features Guideline",
  "editors": [
    {
      "name": "Pieter Bresters",
      "company": "Geonovum",
      "companyURL": "https://www.geonovum.nl"
    }
  ],
  "authors": [
    {
      "name": "Pieter Bresters",
      "company": "Geonovum",
      "companyURL": "https://www.geonovum.nl"
    }
  ],
  "github": "https://github.com/Geonovum/ogc-api-features-guideline",
  "alternateFormats": [
    {
      "label": "pdf",
      "uri": "Guideline.pdf"
    }
  ]
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css"></head>

<body class="h-entry informative toc-inline"><div class="head">
    <a class="logo" href="https://www.geonovum.nl/geo-standaarden"><img alt="Geonovum" height="67" id="Geonovum" src="https://tools.geostandaarden.nl/respec/style/logos/Geonovum.svg" width="132">
  </a> <h1 id="title" class="title">OGC API Features Guideline</h1>
    
    <h2>
      Geonovum Guide<br>
      Editor's draft
      <time class="dt-published" datetime="2024-05-08">May 08, 2024</time>
    </h2>
    <dl>
      
      
      <dt>Latest editor's draft:</dt><dd><a href="https://geonovum.github.io/ogc-api-features-guideline/">https://geonovum.github.io/ogc-api-features-guideline/</a></dd>
      
      
      
      
      
      <dt>Editor:</dt>
      <dd class="editor p-author h-card vcard">
    <span class="p-name fn">Pieter Bresters</span> (<a class="p-org org h-org" href="https://www.geonovum.nl">Geonovum</a>)
  </dd>
      
      <dt>Author:</dt><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Pieter Bresters</span> (<a class="p-org org h-org" href="https://www.geonovum.nl">Geonovum</a>)
  </dd>
      <dt>Participate:</dt><dd>
    <a href="https://github.com/Geonovum/ogc-api-features-guideline/">GitHub Geonovum/ogc-api-features-guideline</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/ogc-api-features-guideline/issues/">File an issue</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/ogc-api-features-guideline/commits/">Commit history</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/ogc-api-features-guideline/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    <p>
          This document is also available in these non-normative format:
          <a rel="alternate" href="Guideline.pdf">pdf</a>
        </p>
    <p class="copyright">
          This document is licensed under 
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/legalcode" class="subfoot"><img class="license" src="https://tools.geostandaarden.nl/respec/style/logos/cc-by.svg" alt="Logo Creative Commons Attribution 4.0 International Public License"><br> Creative Commons Attribution 4.0 International Public License</a>
        </p>
    <hr title="Separator for header">
  </div>
  <section id="abstract" class="introductory"><h2>Abstract</h2>
<p>This document is a guideline for Dutch data providers who want to use OGC-API-Features for download services in a way that they comply with relevant standards.
The guideline has been written on the basis of the experiences gained from implementations of OGC-API-Features of INSPIRE datasets on test beds.
A second important basis is formed by the results of an open tender, held in the beginning of 2023. 
This tender aimed at adjusting tools for serving OGC-API-feature services to 3 standards: OGC, Dutch Application Design Rules and INSPIRE. Until this tender, no tools were known that comply with all these standards.
This guideline describes the requirements, as set out by the standards and uses the demo services from this open tender as an example of how one can comply with the standards.
The aim of setting up these test beds and this guideline, has been to stimulate the Dutch data providers and hosting organizations to start publishing data as OGC API Features.
By doing this, a greater goal is reached: A better use of geospatial data.</p>
<p>A general recommendation to all parties involved, is to adjust as much as possible to the existing requirements as stated in this document.
The most important recommendations for the hosting organizations is to stimulate data providers to start with OGC API features to increase the use of geospatial data according to standards.
Data providers are recommended to first orientate on the possible work of other data providers in this field. A roadmap is described with the steps needed to be taken by data providers in order to serve OGC-API-Features.</p>
</section>
  <section id="sotd" class="introductory"><h2>Status of this document</h2><p>This is a working draft that can be changed, removed or replaced by other documents at any time. It is not a stable document.</p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of this document</a></li><li class="tocline"><a class="tocxref" href="#H01"><bdi class="secno">1. </bdi>OGC API Features explained</a></li><li class="tocline"><a class="tocxref" href="#H02"><bdi class="secno">2. </bdi>Roadmap for data providers</a></li><li class="tocline"><a class="tocxref" href="#H03"><bdi class="secno">3. </bdi>Requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oas"><bdi class="secno">3.1 </bdi>OAS</a></li><li class="tocline"><a class="tocxref" href="#ogc"><bdi class="secno">3.2 </bdi>OGC</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#ogc-api-features-core"><bdi class="secno">3.2.1 </bdi>OGC API Features Core</a></li><li class="tocline"><a class="tocxref" href="#ogc-crs-requirements"><bdi class="secno">3.2.2 </bdi>OGC CRS requirements</a></li><li class="tocline"><a class="tocxref" href="#ogc-filtering"><bdi class="secno">3.2.3 </bdi>OGC Filtering</a></li></ol></li><li class="tocline"><a class="tocxref" href="#dutch-api-design-rules"><bdi class="secno">3.3 </bdi>Dutch API design rules</a></li><li class="tocline"><a class="tocxref" href="#inspire"><bdi class="secno">3.4 </bdi>INSPIRE</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#inspire-crs"><bdi class="secno">3.4.1 </bdi>INSPIRE CRS</a></li><li class="tocline"><a class="tocxref" href="#inspire-multilinguality"><bdi class="secno">3.4.2 </bdi>INSPIRE Multilinguality</a></li><li class="tocline"><a class="tocxref" href="#inspire-predefined-download"><bdi class="secno">3.4.3 </bdi>INSPIRE Predefined download</a></li><li class="tocline"><a class="tocxref" href="#inspire-bulk-download"><bdi class="secno">3.4.4 </bdi>INSPIRE Bulk download</a></li><li class="tocline"><a class="tocxref" href="#inspire-and-geojson"><bdi class="secno">3.4.5 </bdi>INSPIRE and GeoJSON</a></li><li class="tocline"><a class="tocxref" href="#inspire-and-gml"><bdi class="secno">3.4.6 </bdi>INSPIRE and GML</a></li><li class="tocline"><a class="tocxref" href="#inspire-describing-encoding"><bdi class="secno">3.4.7 </bdi>INSPIRE Describing encoding</a></li></ol></li><li class="tocline"><a class="tocxref" href="#relevant-documentation"><bdi class="secno">3.5 </bdi>Relevant documentation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#H04"><bdi class="secno">4. </bdi>Examples of implementations after tool adjustments</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#pygeoapi-versus-requirements"><bdi class="secno">4.1 </bdi>Pygeoapi versus requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oas-0"><bdi class="secno">4.1.1 </bdi>OAS</a></li><li class="tocline"><a class="tocxref" href="#ogc-0"><bdi class="secno">4.1.2 </bdi>OGC</a></li><li class="tocline"><a class="tocxref" href="#dutch-api-design-rules-0"><bdi class="secno">4.1.3 </bdi>Dutch API design rules</a></li><li class="tocline"><a class="tocxref" href="#inspire-0"><bdi class="secno">4.1.4 </bdi>INSPIRE</a></li><li class="tocline"><a class="tocxref" href="#other-findings-on-pygeoapi"><bdi class="secno">4.1.5 </bdi>Other findings on Pygeoapi</a></li></ol></li><li class="tocline"><a class="tocxref" href="#geoserver-versus-requirements"><bdi class="secno">4.2 </bdi>Geoserver versus requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oas-1"><bdi class="secno">4.2.1 </bdi>OAS</a></li><li class="tocline"><a class="tocxref" href="#ogc-1"><bdi class="secno">4.2.2 </bdi>OGC</a></li><li class="tocline"><a class="tocxref" href="#dutch-api-design-rules-1"><bdi class="secno">4.2.3 </bdi>Dutch API design rules</a></li><li class="tocline"><a class="tocxref" href="#inspire-1"><bdi class="secno">4.2.4 </bdi>INSPIRE</a></li><li class="tocline"><a class="tocxref" href="#other-findings-on-geoserver"><bdi class="secno">4.2.5 </bdi>Other findings on Geoserver</a></li></ol></li><li class="tocline"><a class="tocxref" href="#deegree-versus-requirements"><bdi class="secno">4.3 </bdi>Deegree versus requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oas-2"><bdi class="secno">4.3.1 </bdi>OAS</a></li><li class="tocline"><a class="tocxref" href="#ogc-2"><bdi class="secno">4.3.2 </bdi>OGC</a></li><li class="tocline"><a class="tocxref" href="#dutch-api-design-rules-2"><bdi class="secno">4.3.3 </bdi>Dutch API design rules</a></li><li class="tocline"><a class="tocxref" href="#inspire-2"><bdi class="secno">4.3.4 </bdi>INSPIRE</a></li><li class="tocline"><a class="tocxref" href="#other-findings-on-deegree"><bdi class="secno">4.3.5 </bdi>Other findings on Deegree</a></li></ol></li><li class="tocline"><a class="tocxref" href="#general-findings"><bdi class="secno">4.4 </bdi>General findings</a></li><li class="tocline"><a class="tocxref" href="#resulting-documentation"><bdi class="secno">4.5 </bdi>Resulting documentation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">A.1 </bdi>Informative references</a></li></ol></li></ol></nav>

  
  <section id="H01"><div class="header-wrapper"><h2 id="x1-ogc-api-features-explained"><bdi class="secno">1. </bdi>OGC API Features explained</h2><a class="self-link" href="#H01" aria-label="Permalink for Section 1."></a></div>
<p>OGC API Features (OAPIF) is a multi-part standard for services that offer the capability to create, modify, and query spatial data on the Web. 
It specifies requirements and recommendations for APIs that want to follow a standard way of sharing feature data. 
The specification is a multi-part document. [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>], [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-5" title="OGC API - Features - Part 2: Coordinate Reference Systems by Reference">PUB-5</a></cite>], [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-6" title="OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)">PUB-6</a></cite>].</p>
<p>OAPIF is also the term used for a feature download service by means of an API (Application Program Interface) based on OGC standards. 
OAPIF has been considered as the successor of the OGC WFS standard, but that does not mean it will replace it in the near future, although eventually it might.
At this moment, they are complementary to each other. Where WFS is mainly known and used in the GIS community, the OAPIF is aiming at the non GIS-community, like web developers. 
OAPIF is easier to use and needs less knowledge in the spatial domain.
Note as well that WFS adopts the Geography Markup Language (GML) as a default data format. In contrast, OAPIF includes recommendations to support HTML and GeoJSON as encodings.
Implementations of OAPIF may also optionally support GML.</p>
<p>The basis of an OAPIF is the landing page. Examples are shown in <a href="https://geonovum.github.io/ogc-api-features-guideline/#H04">https://geonovum.github.io/ogc-api-features-guideline/#H04</a>.
An OAPIF consists of resources that can be retrieved by typing the corresponding path after the landing page of the OAPIF in a web browser or web application.</p>
<table class="simple">
<thead>
<tr>
<th>Resource</th>
<th>Path</th>
<th>Purpose</th>
</tr>
</thead>
<tbody><tr>
<td>Landing page</td>
<td>/</td>
<td>This is the top-level resource, which serves as an entry point.</td>
</tr>
<tr>
<td>Conformance declaration</td>
<td>/conformance</td>
<td>This resource presents information about the functionality that is implemented by the server.</td>
</tr>
<tr>
<td>API definition</td>
<td>/api</td>
<td>This resource provides metadata about the API itself. Note that the use of /api on the server is optional and the API definition may be hosted on a completely separate server.</td>
</tr>
<tr>
<td>Feature collections</td>
<td>/collections</td>
<td>This resource lists the feature collections that are offered through the API.</td>
</tr>
<tr>
<td>Feature collection</td>
<td>/collections/{collectionId}</td>
<td>This resource describes the feature collection identified in the path.</td>
</tr>
<tr>
<td>Features</td>
<td>/collections/{collectionId}/items</td>
<td>This resource presents the features that are contained in the collection.</td>
</tr>
<tr>
<td>Feature</td>
<td>/collections/{collectionId}/items/{featureId}</td>
<td>This resource presents the feature that is identified in the path.</td>
</tr>
</tbody></table>
<p>In the API definition, one can find all the supported encodings (HTML, JSON) and parameters that can be given along with the URL, such as a bounding box or a limit of the amount of features.
By default, an OAPIF service will provide access to a single dataset.
Rather than sharing the data as a complete dataset, the OGC API Features standards offer direct, fine-grained access to the data at the feature (object) level.</p>
<p>The best way of understanding the concept is looking at the examples that are discussed in the chapter of <a href="#H04">examples</a>.</p>
<p>Since providing a download service is an INSPIRE requirement when responsible for an INSPIRE dataset, the use of OAPIF can be considered for this purpose.
It is even seen as an endorsed <a href="https://inspire.ec.europa.eu/portfolio/good-practice-library/" target="_blank">Good Practice</a> within the INSPIRE community.</p>
<p>While the OAPIF is aiming at the non GIS-community, it is also easy to use for GIS-specialists within a GIS as is shown in the image below.
It works the same as loading a WFS. Only a service name and landing page is required.<br>&nbsp;
      </p><figure id="fig-example-of-using-oapif-in-qgis">
        <img src="media/GIS-example.png" alt="GIS-example">
        <figcaption><a class="self-link" href="#fig-example-of-using-oapif-in-qgis">Figure <bdi class="figno">1</bdi></a> <span class="fig-title">Example of using OAPIF in QGIS</span></figcaption>
      </figure>
    <p></p>
</section>
  <section id="H02"><div class="header-wrapper"><h2 id="x2-roadmap-for-data-providers"><bdi class="secno">2. </bdi>Roadmap for data providers</h2><a class="self-link" href="#H02" aria-label="Permalink for Section 2."></a></div>
<p>The following steps could be considered to follow in order to serve an OGC API Feature service according to the standards:</p>
<ol>
<li>Read this document and all the documents in <a href="https://geonovum.github.io/ogc-api-features-guideline/#references">Appendix A</a>.</li>
<li>Make a choice between publishing by yourself or contact a hosting organization that can help you publish the OAPIF services.</li>
<li><strong>In case of an INSPIRE-dataset</strong>, look what other data providers have done in this field for the concerning INSPIRE themes and have a look at these examples: <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/tree/master/deployments">https://github.com/INSPIRE-MIF/gp-ogc-api-features/tree/master/deployments</a>.</li>
<li>If you decide to serve the OAPIF yourself, the next step is to select the best tooling for your situation. The <a href="#H04">examples</a> in this guideline might help in this regard.</li>
<li>Figure out the best way of supporting more than one CRS, at least <a href="https://epsg.io/4326">WGS84</a> and in case of INSPRE also <a href="https://epsg.io/4258">ETRS89</a> since the last is the most common in INSPIRE and mostly mandatory. 
Dutch providers are also advised to provide the <a href="https://www.opengis.net/def/crs/EPSG/0/28992">Dutch RD</a>.
If tooling is chosen that is not able to serve more than one CRS, a second download option should be provided that does give the data in the required CRS.</li>
<li>Decide on the best input encoding for the OAPIF. It depends on the previous steps and tooling.</li>
<li>If necessary, execute the transformation into the chosen input encoding. This can be done with software like <a href="https://wetransform.to/halestudio/">HALE studio</a>, <a href="https://www.safe.com/">FME</a> or <a href="https://gdal.org/index.html">GDAL</a>. </li>
<li>Decide on the best output encoding, which also depends on the previous steps and tooling. The tooling used in the examples did a simple 1 to 1 mapping between the input and output encoding. </li>
<li><strong>In case of an INSPIRE-dataset</strong>, research whether a previously published mapping to an encoding other than complex GML can be found for the concerned INSPIRE-theme. If so, it can be reused.
If it cannot be found, research how your harmonized data can be mapped to an encoding that can be used in the tooling.
Seek for cooperation with other INSPIRE data providers in Europe and use the principles as stated in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-4" title="INSPIRE UML-to-GeoJSON encoding rule">PUB-4</a></cite>].
The INSPIRE data models contain many non-obligatory fields that remain empty after harmonizing. Consider leaving out these empty fields to reduce the output size or use an option not to show them.</li>
<li><strong>In case of an INSPIRE-dataset</strong>, if not published before, describe the mapping from the INSPIRE data model to the output encoding of the OAPIF and publish it, in order to be INSPIRE compliant.</li>
<li>Adjust your metadata of the dataset with the addition of the OAPIF service. The <a href="https://docs.geostandaarden.nl/md/mdprofiel-iso19115/#protocol">ISO19115 metadata standard</a> uses the protocol element to state the type of service. 
As long as there is no official protocol defined for OAPIF in <a href="https://inspire.ec.europa.eu/metadata-codelist/ProtocolValue:1">https://inspire.ec.europa.eu/metadata-codelist/ProtocolValue:1</a>, use the extended code list for the protocol in the Dutch metadata standard 2.1.0 (<a href="https://docs.geostandaarden.nl/md/mdprofiel-iso19119/#codelist-protocol">https://docs.geostandaarden.nl/md/mdprofiel-iso19119/#codelist-protocol</a>): <code>OGC:API features</code>.</li>
<li>If you host your OAPIF yourself, research how to make metadata for the OAPIF service. It is probably similar to the metadata of a WFS, except for the protocol element.</li>
<li>Add as many links, i.e. references to other resources, as you can at the response to the endpoints of your service to describe your service. <strong>In case of an Inspire dataset</strong>, all the links as mentioned in the chapter on <a href="#H03">requirements</a> are required (metadata of dataset, INSPIRE feature concept dictionary, Licence, mapping description, bulk download).</li>
<li>The steps for final actual publishing of the OAPIF service depends on the chosen tool, so there the tooling guidelines need to be followed:</li>
</ol>
<ul>
<li>Geonovum testbed: <a href="https://github.com/Geonovum/ogc-api-testbed/tree/main/docs/docs/howto">https://github.com/Geonovum/ogc-api-testbed/tree/main/docs/docs/howto</a>  </li>
<li>GoKoala: <a href="https://github.com/PDOK/gokoala">https://github.com/PDOK/gokoala</a>   </li>
<li>Pygeoapi: <a href="https://github.com/Geonovum/ogc-api-testbed/blob/main/docs/docs/howto/howto_pygeoapi.md">https://github.com/Geonovum/ogc-api-testbed/blob/main/docs/docs/howto/howto_pygeoapi.md</a> or <a href="https://docs.pygeoapi.io/en/latest/">https://docs.pygeoapi.io/en/latest/</a>  </li>
<li>Geoserver: <a href="https://github.com/Geonovum/ogc-api-testbed/blob/main/docs/docs/howto/howto_geoserver.md">https://github.com/Geonovum/ogc-api-testbed/blob/main/docs/docs/howto/howto_geoserver.md</a> or <a href="https://docs.geoserver.org/latest/en/user/">https://docs.geoserver.org/latest/en/user/</a>  </li>
<li>Deegree: <a href="https://github.com/deegree/deegree-ogcapi">https://github.com/deegree/deegree-ogcapi</a></li>
</ul>
<ol start="15">
<li>Validate the OAPIF service for the OGC requirement with the <a href="https://inspire.ec.europa.eu/validator/home/index.html">INSPIRE validation tool</a> and in case of a Dutch provider: the <a href="https://gitlab.com/commonground/don/adr-validator/-/blob/main/README.md?ref_type=heads">Dutch ADR-validator</a>.<br>Adjust where possible to be compliant.
It should be noted that the INSPIRE-validator is the same as the <a href="https://cite.opengeospatial.org/teamengine/about/ogcapi-features-1.0/1.0/site/">OGC validator</a> and that it does not test the specific INSPIRE requirements as one would expect.</li>
</ol>
</section>
  <section id="H03"><div class="header-wrapper"><h2 id="x3-requirements"><bdi class="secno">3. </bdi>Requirements</h2><a class="self-link" href="#H03" aria-label="Permalink for Section 3."></a></div>
<p>Below the most relevant requirements (or requirement classes) for setting up an OAPIF are listed:</p>
<table class="simple">
<thead>
<tr>
<th>Nr</th>
<th>Source</th>
<th>requirements</th>
<th>reference</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>OAS</td>
<td>Open API Specification</td>
<td><a href="https://www.openapis.org/">https://www.openapis.org/</a></td>
</tr>
<tr>
<td>2</td>
<td>OGC</td>
<td><a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html">OGC API Features Core</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>]</td>
</tr>
<tr>
<td>3</td>
<td>OGC</td>
<td>CRS requirements</td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-5" title="OGC API - Features - Part 2: Coordinate Reference Systems by Reference">PUB-5</a></cite>]</td>
</tr>
<tr>
<td>4</td>
<td>OGC</td>
<td><a href="https://docs.ogc.org/DRAFTS/19-079r1.html">OGC filtering</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-6" title="OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)">PUB-6</a></cite>]</td>
</tr>
<tr>
<td>5</td>
<td>Dutch ADR</td>
<td><a href="https://www.geonovum.nl/over-geonovum/actueel/rest-api-design-rules-op-pas-toe-leg-uit-lijst">Dutch API design rules</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-3" title="Dutch API design rules">PUB-3</a></cite>]</td>
</tr>
<tr>
<td>6</td>
<td>INSPIRE</td>
<td><a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md">INPSIRE-MIF document: Setting up an INSPIRE Download service based on the OGC API-Features standard</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>]</td>
</tr>
<tr>
<td>7</td>
<td>INSPIRE</td>
<td><a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-crs">CRS requirements</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] #req-crs</td>
</tr>
<tr>
<td>8</td>
<td>INSPIRE</td>
<td><a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#82-requirements-class-inspire-multilinguality-">multilinguality</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] #82-requirements-class-inspire-multilinguality-</td>
</tr>
<tr>
<td>9</td>
<td>INSPIRE</td>
<td>[predefined download](<a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-pre-defined">https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-pre-defined</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] #req-pre-defined</td>
</tr>
<tr>
<td>10</td>
<td>INSPIRE</td>
<td><a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-bulk-download">bulk download</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] #req-bulk-download</td>
</tr>
<tr>
<td>11</td>
<td>INSPIRE</td>
<td><a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-oapif-json">GeoJSON</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] #req-oapif-json</td>
</tr>
<tr>
<td>12</td>
<td>INSPIRE</td>
<td>INSPIRE validated GML as <a href="https://inspire.ec.europa.eu/validator/about/">input</a> and <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_requirements_class_geography_markup_language_gml_simple_features_profile_level_2">output</a></td>
<td><a href="https://inspire.ec.europa.eu/validator/about/">https://inspire.ec.europa.eu/validator/about/</a> and [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>] #_requirements_classes_for_encodings</td>
</tr>
<tr>
<td>13</td>
<td>INSPIRE</td>
<td><a href="https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/geojson-encoding-rule.md#inspire-requirements-for-encoding-rules">describing encoding</a></td>
<td>[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-4" title="INSPIRE UML-to-GeoJSON encoding rule">PUB-4</a></cite>]</td>
</tr>
</tbody></table>
<section id="oas"><div class="header-wrapper"><h3 id="x3-1-oas"><bdi class="secno">3.1 </bdi>OAS</h3><a class="self-link" href="#oas" aria-label="Permalink for Section 3.1"></a></div>
<p>The Open API Specification as set up by the <a href="https://openapis.org/">OpenAPI Initiative</a> requires a document that describes an API or elements of an API. 
It can mostly be obtained by typing "openapi" behind the URL of the landing page of the service.
An OpenAPI document uses and conforms to the <a href="https://spec.openapis.org/oas/v3.1.0">OpenAPI Specification</a>.
It describes all the possible fields that can or should be used in the OpenAPI document.
The OpenAPI document <em class="rfc2119">MUST</em> contain at least one paths field, a components field or a webhooks field.</p>
</section><section id="ogc"><div class="header-wrapper"><h3 id="x3-2-ogc"><bdi class="secno">3.2 </bdi>OGC</h3><a class="self-link" href="#ogc" aria-label="Permalink for Section 3.2"></a></div>
<section id="ogc-api-features-core"><div class="header-wrapper"><h4 id="x3-2-1-ogc-api-features-core"><bdi class="secno">3.2.1 </bdi>OGC API Features Core</h4><a class="self-link" href="#ogc-api-features-core" aria-label="Permalink for Section 3.2.1"></a></div>
<p><a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html">OGC API Features Core</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>] describes the basic requirements (50) and recommendations (17) according to OGC that one needs to follow, independent of INSPIRE. 
It describes which paths can be used and what responses one should receive. 
It does not make the use of the <a href="https://spec.openapis.org/oas/v3.0.0">OpenAPI Specification 3.0</a>) mandatory, but if it is used, it gives an extra <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#rc_oas30">requirement class</a>.
Presumably, this also counts for higher versions of the OpenAPI Specification.</p>
<p>The <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_requirements_class_geojson">GeoJSON requirement class</a> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>] recommends to support GeoJSON for features with geometry, but as stated in <a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_encodings">https://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_encodings</a>, no encoding is mandatory. </p>
<p><a href="https://docs.ogc.org/is/17-069r4/17-069r4.html#rec_core_fc-md-descriptions">Metadata links</a> are recommended in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>] #rec_core_fc-md-descriptions.</p>
<p>There is an INSPIRE validation on the OGC standards for OAPIF available. It tests on OGC requirements, but it does not test the requirements as stated in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>].
&nbsp;&nbsp;
      </p><figure id="fig-validation-on-the-ogc-standards-for-oapif">
        <img src="media/INSPIRE_validator_OAPIF.png" alt="INSPIRE Validator">
        <figcaption><a class="self-link" href="#fig-validation-on-the-ogc-standards-for-oapif">Figure <bdi class="figno">2</bdi></a> <span class="fig-title">Validation on the OGC standards for OAPIF</span></figcaption>
      </figure>
    <p></p>
</section><section id="ogc-crs-requirements"><div class="header-wrapper"><h4 id="x3-2-2-ogc-crs-requirements"><bdi class="secno">3.2.2 </bdi>OGC CRS requirements</h4><a class="self-link" href="#ogc-crs-requirements" aria-label="Permalink for Section 3.2.2"></a></div>
<p>Both OGC and INSPIRE have requirements related to the CRS's used in addition to the basic requirement from the OGC API Features Core standard.
The <a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_coordinate_reference_systems">CRS requirement</a> in the OGC API Features Core standard [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>], requires <a href="http://www.opengis.net/def/crs/OGC/1.3/CRS84">WGS84</a> for 2D-data and <a href="http://www.opengis.net/def/crs/OGC/0/CRS84h">WGS84h</a> for 3D-data as default.
The <a href="http://docs.opengeospatial.org/is/18-058r1/18-058r1.html">OGC API - Features - Part 2 standard</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-5" title="OGC API - Features - Part 2: Coordinate Reference Systems by Reference">PUB-5</a></cite>] prescribes how to support different coordinate systems with OAPIF.
Among other requirements, the requirements concern a CRS identifier list, Storage-CRS, a bbox-crs parameter and a content-CRS in the header of the body of the response.</p>
</section><section id="ogc-filtering"><div class="header-wrapper"><h4 id="x3-2-3-ogc-filtering"><bdi class="secno">3.2.3 </bdi>OGC Filtering</h4><a class="self-link" href="#ogc-filtering" aria-label="Permalink for Section 3.2.3"></a></div>
<p>The specification for <a href="https://docs.ogc.org/DRAFTS/19-079r1.html">filtering</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-6" title="OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)">PUB-6</a></cite>] is still a draft version and has therefore not yet been taken into account.
Some basic filtering requirements are described in <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_items_">OGC API - Features - Part 1: Core</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>].
This only concerns filtering with a bounding box and on properties.</p>
</section></section><section id="dutch-api-design-rules"><div class="header-wrapper"><h3 id="x3-3-dutch-api-design-rules"><bdi class="secno">3.3 </bdi>Dutch API design rules</h3><a class="self-link" href="#dutch-api-design-rules" aria-label="Permalink for Section 3.3"></a></div>
<p>Dutch data providers are recommended to follow the <a href="https://www.geonovum.nl/over-geonovum/actueel/rest-api-design-rules-op-pas-toe-leg-uit-lijst">Dutch API design rules</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-3" title="Dutch API design rules">PUB-3</a></cite>] and the <a href="https://docs.geostandaarden.nl/api/API-Strategie-mod-geo/">Geomodule</a>. </p>
<p>For the Dutch data providers, it is recommended to also support <a href="https://www.opengis.net/def/crs/EPSG/0/28992">RD-coordinatesystem</a> for 2D data or <a href="https://www.opengis.net/def/crs/EPSG/0/7415">RD +NAP</a> for 3D data. See also: <a href="https://docs.geostandaarden.nl/crs/crs">https://docs.geostandaarden.nl/crs/crs</a>. </p>
</section><section id="inspire"><div class="header-wrapper"><h3 id="x3-4-inspire"><bdi class="secno">3.4 </bdi>INSPIRE</h3><a class="self-link" href="#inspire" aria-label="Permalink for Section 3.4"></a></div>
<p><a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md">INSPIRE-MIF document: Setting up an INSPIRE Download service based on the OGC API-Features standard</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] describes the specific INSPIRE requirements.
Most of them are explained in the next chapters.
This document does propose in <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#81-requirements-class-inspire-pre-defined-data-set-download-oapif--">Note 2</a> to make it a mandatory requirement for INSPIRE to comply with <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#rc_oas30">OAPIF requirements class OpenAPI 3.0.</a></p>
<section id="inspire-crs"><div class="header-wrapper"><h4 id="x3-4-1-inspire-crs"><bdi class="secno">3.4.1 </bdi>INSPIRE CRS</h4><a class="self-link" href="#inspire-crs" aria-label="Permalink for Section 3.4.1"></a></div>
<p>The <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-crs">INSPIRE-CRS requirement class</a> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] requires also one of the INSPIRE CRS's based on ETRS89 to be supported.</p>
</section><section id="inspire-multilinguality"><div class="header-wrapper"><h4 id="x3-4-2-inspire-multilinguality"><bdi class="secno">3.4.2 </bdi>INSPIRE Multilinguality</h4><a class="self-link" href="#inspire-multilinguality" aria-label="Permalink for Section 3.4.2"></a></div>
<p>The <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#82-requirements-class-inspire-multilinguality-">multilinguality requirement class</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] is mandatory for all data sets that contain information in more than one natural language.
This is mostly not the case in the Netherlands, so it is of less importance.</p>
</section><section id="inspire-predefined-download"><div class="header-wrapper"><h4 id="x3-4-3-inspire-predefined-download"><bdi class="secno">3.4.3 </bdi>INSPIRE Predefined download</h4><a class="self-link" href="#inspire-predefined-download" aria-label="Permalink for Section 3.4.3"></a></div>
<p>The <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-pre-defined">predefined download requirement class</a>,[<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] consists of 3 requirements for each collection to include links to:</p>
<ol>
<li>the <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#metadata-elements-of-the-data-set">metadata of the corresponding dataset</a> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>]</li>
<li>the corresponding entry in the <a href="https://inspire.ec.europa.eu/featureconcept">INSPIRE feature concept dictionary</a></li>
<li>the <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#terms-of-use">license</a></li>
</ol>
</section><section id="inspire-bulk-download"><div class="header-wrapper"><h4 id="x3-4-4-inspire-bulk-download"><bdi class="secno">3.4.4 </bdi>INSPIRE Bulk download</h4><a class="self-link" href="#inspire-bulk-download" aria-label="Permalink for Section 3.4.4"></a></div>
<p>The <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-bulk-download">bulk download requirement class</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] requires links for enclosure of the total data set and/or of each separate collection.</p>
</section><section id="inspire-and-geojson"><div class="header-wrapper"><h4 id="x3-4-5-inspire-and-geojson"><bdi class="secno">3.4.5 </bdi>INSPIRE and GeoJSON</h4><a class="self-link" href="#inspire-and-geojson" aria-label="Permalink for Section 3.4.5"></a></div>
<p>The <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#req-oapif-json">GeoJSON requirement class</a> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-2" title="Setting up an INSPIRE Download service based on the OGC API-Features standard">PUB-2</a></cite>] recommends to document how the GeoJSON encoding is retrieved from the INSPIRE data models.</p>
</section><section id="inspire-and-gml"><div class="header-wrapper"><h4 id="x3-4-6-inspire-and-gml"><bdi class="secno">3.4.6 </bdi>INSPIRE and GML</h4><a class="self-link" href="#inspire-and-gml" aria-label="Permalink for Section 3.4.6"></a></div>
<p>The use of GML as encoding for INSPIRE data can be considered in two ways: as input and as output.</p>
<p>When we consider the input, one would like to be able to use a source dataset of harmonized data. In most cases, this will be a GML encoded dataset. 
The GML encoding is at least needed to validate the data set with the <a href="https://inspire.ec.europa.eu/validator/about/">EU INSPIRE  validator</a>.<br>Unfortunately, not many tooling for creating a OAPIF service is able to use GML as input. Especially when it concerns a complex GML dataset. So, a transformation to another encoding like GeoJSON is needed.</p>
<p>Output of GML from the OAPIF service can only be in simple features <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_requirements_class_geography_markup_language_gml_simple_features_profile_level_0">level 0</a> and <a href="http://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_requirements_class_geography_markup_language_gml_simple_features_profile_level_2">level 2</a>.
So no complex features will be supported.</p>
</section><section id="inspire-describing-encoding"><div class="header-wrapper"><h4 id="x3-4-7-inspire-describing-encoding"><bdi class="secno">3.4.7 </bdi>INSPIRE Describing encoding</h4><a class="self-link" href="#inspire-describing-encoding" aria-label="Permalink for Section 3.4.7"></a></div>
<p>The standards considered in this guideline do not set a specific encoding as mandatory (see <a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_encodings">https://docs.opengeospatial.org/is/17-069r4/17-069r4.html#_encodings</a>) [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-1" title="OGC API Features Part1:Core">PUB-1</a></cite>].
If another encoding than GML is used for publishing an INSPIRE dataset, data providers need to document how the encoding relates to the concerned INSPIRE data model.
The good practice on <a href="https://inspire.ec.europa.eu/good-practice/geopackage-encoding-inspire-datasets">GeoPackages encoding of INSPIRE datasets</a> describes how this can be done.</p>
</section></section><section id="relevant-documentation"><div class="header-wrapper"><h3 id="x3-5-relevant-documentation"><bdi class="secno">3.5 </bdi>Relevant documentation</h3><a class="self-link" href="#relevant-documentation" aria-label="Permalink for Section 3.5"></a></div>
<p>Relevant documentation is shown in <a href="#references">appendix A. References</a>.</p>
</section></section>
  <section id="H04"><div class="header-wrapper"><h2 id="x4-examples-of-implementations-after-tool-adjustments"><bdi class="secno">4. </bdi>Examples of implementations after tool adjustments</h2><a class="self-link" href="#H04" aria-label="Permalink for Section 4."></a></div>
<p>From earlier tests Geonovum concluded tools were not compliant with the requirements for OAS, OGC, INSPIRE and Dutch ADR. For that reason Geonovum set up an open tender at the beginning of the year 2023, with the goal of improving the compliance of OGC API tooling.
This resulted in 3 demo services that each show how you can be compliant with the requirements.
All demo services used the same selection of the Dutch INSPIRE Addresses in a simplified GML file, constructed by Wetransform as input.</p>
<table class="simple">
<thead>
<tr>
<th>tool</th>
<th>main contributions</th>
<th>landing page</th>
</tr>
</thead>
<tbody><tr>
<td>Pygeoapi</td>
<td>Justobjects and Geocat</td>
<td><a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1">https://apitestbed.geonovum.nl/adr_pygeoapi/v1</a></td>
</tr>
<tr>
<td>Geoserver</td>
<td>Geosolutions</td>
<td><a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1</a></td>
</tr>
<tr>
<td>Deegree</td>
<td>Wetransform</td>
<td><a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1</a></td>
</tr>
</tbody></table>
<p>Per tool, findings are elaborated in the next chapters when relevant.</p>
<section id="pygeoapi-versus-requirements"><div class="header-wrapper"><h3 id="x4-1-pygeoapi-versus-requirements"><bdi class="secno">4.1 </bdi>Pygeoapi versus requirements</h3><a class="self-link" href="#pygeoapi-versus-requirements" aria-label="Permalink for Section 4.1"></a></div>
<p>The following findings show how Pygeoapi complies to the requirements.</p>
<section id="oas-0"><div class="header-wrapper"><h4 id="x4-1-1-oas"><bdi class="secno">4.1.1 </bdi>OAS</h4><a class="self-link" href="#oas-0" aria-label="Permalink for Section 4.1.1"></a></div>
<p>The OAS document is available: <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/openapi">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/openapi</a></p>
</section><section id="ogc-0"><div class="header-wrapper"><h4 id="x4-1-2-ogc"><bdi class="secno">4.1.2 </bdi>OGC</h4><a class="self-link" href="#ogc-0" aria-label="Permalink for Section 4.1.2"></a></div>
<p>The OGC CITE validator gave no error at the <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1">landing page</a>.</p>
<p><em><strong>Filtering</strong></em>  </p>
<p>For the use of filters, the bbox and items options were already available. In addition, one can filter on the attributes which can be retrieved from
<a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/queryables">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/queryables</a>.
The OGC API specification for filtering [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-6" title="OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)">PUB-6</a></cite>] does not yet have the status "approved" and has not yet been considered.</p>
<p><em><strong>CRS</strong></em></p>
<p>The crs identifier list and storage-crs can be found at the end of:
<a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json</a> </p>
<p>With the following command line request, one can see the Content-CRS value in the header:</p>
<p><code>curl -i https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json</code></p>
<p>An adjustment has been made to the bbox filter. It now also supports the bbox-crs parameter.
Only 2 addresses are available in the below defined bbox.
<a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items?f=json&amp;bbox-crs=http://www.opengis.net/def/crs/EPSG/0/28992&amp;bbox=252200,593000,252710,594000">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items?f=json&amp;bbox-crs=http://www.opengis.net/def/crs/EPSG/0/28992&amp;bbox=252200,593000,252710,594000</a></p>
</section><section id="dutch-api-design-rules-0"><div class="header-wrapper"><h4 id="x4-1-3-dutch-api-design-rules"><bdi class="secno">4.1.3 </bdi>Dutch API design rules</h4><a class="self-link" href="#dutch-api-design-rules-0" aria-label="Permalink for Section 4.1.3"></a></div>
<p>It complies with all the rules, except for rule <a href="https://publicatie.centrumvoorstandaarden.nl/api/adr/#api-48">https://publicatie.centrumvoorstandaarden.nl/api/adr/#api-48</a>.
This rule in the Dutch ADR prescribes that none of the API endpoints should have a trailing slash. However, the OGC specification states that the landing page (i.e. "Home") should have a trailing slash. So the rules contradict.
It is expected that in future, this ADR-rule will make an exception for the landing page.</p>
</section><section id="inspire-0"><div class="header-wrapper"><h4 id="x4-1-4-inspire"><bdi class="secno">4.1.4 </bdi>INSPIRE</h4><a class="self-link" href="#inspire-0" aria-label="Permalink for Section 4.1.4"></a></div>
<p><em><strong>CRS ETRS89 and WGS84</strong></em></p>
<p>The required CRS's are available:</p>
<ul>
<li>RD: <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/28992">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/28992</a></li>
<li>WGS84: <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/OGC/1.3/CRS84">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/OGC/1.3/CRS84</a></li>
<li>ETRS89:  <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/4258">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/4258</a></li>
</ul>
<p><em><strong>Predefined download</strong></em>  </p>
<p>Link to metadata of dataset: passed at <code>/collections/AddressesNL</code> and at <code>/collections</code> level:<br><code>{"href": "https://www.nationaalgeoregister.nl/geonetwork/srv/dut/catalog.search#/metadata/a5f961e9-ebdd-41e2-b8e8-ab33ed340a83",   "hreflang": "nl",   "type": "text/html",   "rel": "describedby",   "title": "Metadata as HTML"}</code></p>
<p><code>{"href": "https://www.nationaalgeoregister.nl/geonetwork/srv/api/records/a5f961e9-ebdd-41e2-b8e8-ab33ed340a83/formatters/xml",   "hreflang": "nl",   "type": "application/xml",   "rel": "describedby",   "title": "Metadata as ISO 19139 XML"}</code></p>
<p>Link to INSPIRE feature concept dictionary: passed at /collections/AddressesNL and at /collections level:<br><code>{"href": "https://inspire.ec.europa.eu/featureconcept/Address",   "hreflang": "en",   "type": "text/html",   "rel": "tag",   "title": "INSPIRE feature concept dictionary for addresses"}</code></p>
<p>Link to the license: passed at /collections/AddressesNL and at /collections level:<br><code>{"href": "https://creativecommons.org/publicdomain/zero/1.0/deed.en",   "hreflang": "en",   "type": "text/html",   "rel": "license",   "title": "CC0 1.0 Public Domain license"}</code></p>
<p>See also <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections?f=json">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections?f=json</a> and 
<a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json</a></p>
<p><em><strong>bulk download</strong></em></p>
<p>Link to bulk download of dataset: passed at /collections/AddressesNL and at /collections level.</p>
<p>See also <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections?f=json">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections?f=json</a> and<br><a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json">https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json</a>
<code>{"href": "https://service.pdok.nl/kadaster/ad/atom/downloads/addresses.gml.gz",   "hreflang": "nl",   "length": 685450191,   "type": "application/x-gmz",   "rel": "enclosure",   "title": "Download complete dataset as GML"}</code></p>
<p><em><strong>GeoJSON</strong></em></p>
<p>Items can be retrieved in GeoJSON by requesting:  </p>
<p><code>https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL/items?f=json</code></p>
<p><em><strong>GML</strong></em> </p>
<p>As input, a simple features GML file was used as produced by Wetransform from the complex feature GML with the transformation software Hale.  </p>
<p>As output, there is a link to the original complex feature GML-file:
<a href="https://service.pdok.nl/kadaster/ad/atom/downloads/addresses.gml.gz">https://service.pdok.nl/kadaster/ad/atom/downloads/addresses.gml.gz</a> </p>
<p>Pygeoapi does not support GML-output at item-level, but this is not a requirement.</p>
<p><em><strong>Describing encoding</strong></em>  </p>
<p>There is a link to <a href="https://github.com/INSPIRE-MIF/2017.2/tree/master/GeoJSON/ads">https://github.com/INSPIRE-MIF/2017.2/tree/master/GeoJSON/ads</a> at <a href="https://apitestbed.geonovum.nl/adr_pygeoapi/v1/collections/AddressesNL?f=json">collections/AddressesNL level</a>:  </p>
<p><code>{"href": "https://github.com/INSPIRE-MIF/2017.2/tree/master/GeoJSON/ads",   "hreflang": "en",   "type": "text/html",   "rel": "about",   "title": "Description of the encoding"}</code>  </p>
</section><section id="other-findings-on-pygeoapi"><div class="header-wrapper"><h4 id="x4-1-5-other-findings-on-pygeoapi"><bdi class="secno">4.1.5 </bdi>Other findings on Pygeoapi</h4><a class="self-link" href="#other-findings-on-pygeoapi" aria-label="Permalink for Section 4.1.5"></a></div>
<p>More information about the Pygeoapi adjustments to the standards can be found at <a href="https://pygeoapi.io/presentations/geonovum-tender-2023/">https://pygeoapi.io/presentations/geonovum-tender-2023/</a></p>
</section></section><section id="geoserver-versus-requirements"><div class="header-wrapper"><h3 id="x4-2-geoserver-versus-requirements"><bdi class="secno">4.2 </bdi>Geoserver versus requirements</h3><a class="self-link" href="#geoserver-versus-requirements" aria-label="Permalink for Section 4.2"></a></div>
<p>The following findings show how Geoserver complies to the requirements.</p>
<section id="oas-1"><div class="header-wrapper"><h4 id="x4-2-1-oas"><bdi class="secno">4.2.1 </bdi>OAS</h4><a class="self-link" href="#oas-1" aria-label="Permalink for Section 4.2.1"></a></div>
<p>The OAS document is available: <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/openapi">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/openapi</a></p>
</section><section id="ogc-1"><div class="header-wrapper"><h4 id="x4-2-2-ogc"><bdi class="secno">4.2.2 </bdi>OGC</h4><a class="self-link" href="#ogc-1" aria-label="Permalink for Section 4.2.2"></a></div>
<p>The OGC CITE validator gave no error at the landing page <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1</a>.</p>
<p><em><strong>Filtering</strong></em>  </p>
<p>For the use of filters, the bbox and items options were already available. In addition, one can filter on the attributes which can be retrieved from:
<a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses?queryables">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses?queryables</a>.  </p>
<p>The OGC API specification for filtering [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-6" title="OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)">PUB-6</a></cite>] does not yet have the status "approved" and has not yet been considered.</p>
<p><em><strong>CRS</strong></em></p>
<p>The crs identifier list and the storage-crs can be found at:
<a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json</a></p>
<p>With the following command line request, one can see the Content-CRS value in the header :</p>
<p><code>curl -i https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress/items/1?f=json</code></p>
<p>An adjustment has been made to the bbox filter. It now also supports the bbox-crs parameter.
Only 2 addresses are available in the below defined bbox.  </p>
<p><a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress/items?f=json&amp;bbox-crs=http://www.opengis.net/def/crs/EPSG/0/28992&amp;bbox=252200,593000,252710,594000">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress/items?f=json&amp;bbox-crs=http://www.opengis.net/def/crs/EPSG/0/28992&amp;bbox=252200,593000,252710,594000</a></p>
</section><section id="dutch-api-design-rules-1"><div class="header-wrapper"><h4 id="x4-2-3-dutch-api-design-rules"><bdi class="secno">4.2.3 </bdi>Dutch API design rules</h4><a class="self-link" href="#dutch-api-design-rules-1" aria-label="Permalink for Section 4.2.3"></a></div>
<p>It complies with all the rules, except for rule <a href="https://publicatie.centrumvoorstandaarden.nl/api/adr/#api-48">https://publicatie.centrumvoorstandaarden.nl/api/adr/#api-48</a>.
This rule in the Dutch ADR prescribes that none of the API endpoints should have a trailing slash. However, the OGC specification states that the landing page (i.e. "Home") should have a trailing slash. So the rules contradict.
It is expected that in future, this ADR-rule will make an exception for the landing page.</p>
</section><section id="inspire-1"><div class="header-wrapper"><h4 id="x4-2-4-inspire"><bdi class="secno">4.2.4 </bdi>INSPIRE</h4><a class="self-link" href="#inspire-1" aria-label="Permalink for Section 4.2.4"></a></div>
<p><em><strong>CRS ETRS89 and WGS84</strong></em></p>
<p>The required CRS's are available:</p>
<ul>
<li>RD: <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/28992">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/28992</a></li>
<li>WGS84: <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/OGC/1.3/CRS84">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/OGC/1.3/CRS84</a></li>
<li>ETRS89:  <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/4258">https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/Addresses/items/1?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/4258</a></li>
</ul>
<p><em><strong>Predefined download</strong></em>  </p>
<p>Link to metadata of dataset: passed at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json">/collections/collection level</a> and at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections?f=json">/collections level</a>. 
<code>{"href":"https://www.nationaalgeoregister.nl/geonetwork/srv/api/records/a5f961e9-ebdd-41e2-b8e8-ab33ed340a83/formatters/xml?approved=true","rel":"describedBy","type":"application/xml","title":"ISO metadata for this dataset"}</code></p>
<p>Link to INSPIRE feature concept dictionary: passed at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json">/collections/collection level</a>. 
<code>{"href":"https://inspire.ec.europa.eu/featureconcept/Address","rel":"tag","type":"text/html","title":"INSPIRE Address feature concept."}</code></p>
<p>Link to the license: passed at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections?f=json">/collections level</a>. 
<code>{"href":"http://creativecommons.org/publicdomain/zero/1.0/deed.nl","rel":"license","type":"text/html","title":"Dataset license."}</code></p>
<p><em><strong>bulk download</strong></em></p>
<p>Link to bulk download of dataset: passed at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json">/collections/collection level</a>.<br><code>{"href":"https://geonovum.geosolutionsgroup.com/geoserver/www/ADNL.gpkg","rel":"enclosure","type":"application/geopackage+sqlite3","title":"Addresses raw data."}</code></p>
<p><em><strong>GeoJSON</strong></em></p>
<p>Items can be retrieved in GeoJSON by requesting:</p>
<p><code>https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress/items/1?f=application%2Fgeo%2Bjson</code></p>
<p><em><strong>GML</strong></em> </p>
<p>As input, a simple features GML file was used as produced by Wetransform from the complex feature GML with the transformation software Hale.  </p>
<p>As output, the following link can be found at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json">/collections/collection level</a>. It can be used to download the first 50 records. </p>
<p><code>{"href":"https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress/items?f=application%2Fgml%2Bxml%3Bversion%3D3.2","rel":"items","type":"application/gml+xml;version=3.2","title":"Addresses items as application/gml+xml;version=3.2"}</code> </p>
<p><em><strong>Describing encoding</strong></em>  </p>
<p>There is a link to <a href="https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/ads/simple-addresses.md">https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/ads/simple-addresses.md</a> at <a href="https://geonovum.geosolutionsgroup.com/geoserver/inspire/ogc/features/v1/collections/SimpleAddress?f=json">/collections/collection level</a>. </p>
<p><code>{"href":"https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/ads/simple-addresses.md","rel":"describedBy","type":"text/html","title":"GeoJSON Encoding Rule for INSPIRE Addresses"}</code></p>
</section><section id="other-findings-on-geoserver"><div class="header-wrapper"><h4 id="x4-2-5-other-findings-on-geoserver"><bdi class="secno">4.2.5 </bdi>Other findings on Geoserver</h4><a class="self-link" href="#other-findings-on-geoserver" aria-label="Permalink for Section 4.2.5"></a></div>
<p>More information about the Geoserver adjustments to the standards can be found at <a href="https://www.geonovum.nl/uploads/documents/Geosolutions.pdf">https://www.geonovum.nl/uploads/documents/Geosolutions.pdf</a></p>
</section></section><section id="deegree-versus-requirements"><div class="header-wrapper"><h3 id="x4-3-deegree-versus-requirements"><bdi class="secno">4.3 </bdi>Deegree versus requirements</h3><a class="self-link" href="#deegree-versus-requirements" aria-label="Permalink for Section 4.3"></a></div>
<p>The following findings show how Geoserver complies to the requirements.</p>
<section id="oas-2"><div class="header-wrapper"><h4 id="x4-3-1-oas"><bdi class="secno">4.3.1 </bdi>OAS</h4><a class="self-link" href="#oas-2" aria-label="Permalink for Section 4.3.1"></a></div>
<p>The OAS document is available: <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/openapi">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/openapi</a></p>
</section><section id="ogc-2"><div class="header-wrapper"><h4 id="x4-3-2-ogc"><bdi class="secno">4.3.2 </bdi>OGC</h4><a class="self-link" href="#ogc-2" aria-label="Permalink for Section 4.3.2"></a></div>
<p>The OGC CITE validator gave no error at the landing page: <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1</a>.</p>
<p><em><strong>Filtering</strong></em>  </p>
<p>For the use of filters, the bbox and items options were already available.</p>
<p>The OGC API specification for filtering [<cite><a class="bibref" data-link-type="biblio" href="#bib-pub-6" title="OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)">PUB-6</a></cite>] does not yet have the status "approved" and has not yet been considered.</p>
<p><em><strong>CRS</strong></em></p>
<p>The crs identifier list and storage-crs can be found at:
<a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress?f=json">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress?f=json</a></p>
<p>With the following command line request, one can see the Content-CRS value in the header :</p>
<p><code>curl -i https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items?limit=1</code></p>
<p>An adjustment has been made tot the bbox filter. It now also supports the bbox-crs parameter.
Only 2 addresses are available in the below defined bbox.
<a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items?f=json&amp;bbox-crs=http://www.opengis.net/def/crs/EPSG/0/28992&amp;bbox=252200,593000,252710,594000">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items?f=json&amp;bbox-crs=http://www.opengis.net/def/crs/EPSG/0/28992&amp;bbox=252200,593000,252710,594000</a></p>
</section><section id="dutch-api-design-rules-2"><div class="header-wrapper"><h4 id="x4-3-3-dutch-api-design-rules"><bdi class="secno">4.3.3 </bdi>Dutch API design rules</h4><a class="self-link" href="#dutch-api-design-rules-2" aria-label="Permalink for Section 4.3.3"></a></div>
<p>It complies with all the rules, except for rule <a href="https://publicatie.centrumvoorstandaarden.nl/api/adr/#api-48">https://publicatie.centrumvoorstandaarden.nl/api/adr/#api-48</a>.
This rule in the Dutch ADR prescribes that none of the API endpoints should have a trailing slash. However, the OGC specification states that the landing page (i.e. "Home") should have a trailing slash. So the rules contradict.
It is expected that in future, this ADR-rule will make an exception for the landing page.</p>
</section><section id="inspire-2"><div class="header-wrapper"><h4 id="x4-3-4-inspire"><bdi class="secno">4.3.4 </bdi>INSPIRE</h4><a class="self-link" href="#inspire-2" aria-label="Permalink for Section 4.3.4"></a></div>
<p><em><strong>CRS ETRS89 and WGS84</strong></em></p>
<p>The required CRS's are available:</p>
<ul>
<li>RD: <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/28992">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/28992</a></li>
<li>WGS84: <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json&amp;crs=http://www.opengis.net/def/crs/OGC/1.3/CRS84">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json&amp;crs=http://www.opengis.net/def/crs/OGC/1.3/CRS84</a></li>
<li>ETRS89: <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/4258">https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json&amp;crs=http://www.opengis.net/def/crs/EPSG/0/4258</a></li>
</ul>
<p><em><strong>Predefined download</strong></em>  </p>
<p>Link to metadata of dataset: passed at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections?f=json">/collections level</a>:  </p>
<p><code>{"href":"https://www.nationaalgeoregister.nl/geonetwork/srv/dut/catalog.search#/metadata/a5f961e9-ebdd-41e2-b8e8-ab33ed340a83","rel":"describedby","type":"text/html","title":"Metadata"}</code></p>
<p>Link to INSPIRE feature concept dictionary: passed at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress?f=json">/collections/collection level</a> and at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections?f=json">/collections level</a>:  </p>
<p><code>{"href":"https://inspire.ec.europa.eu/featureconcept/Address","rel":"tag","type":"text/html","title":"Feature concept Address"}</code></p>
<p>Link to the license: passed at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections?f=json">/collections level</a>:  </p>
<p><code>{"href":"http://creativecommons.org/publicdomain/zero/1.0/deed.nl","rel":"license","type":"text/html","title":"License"}</code></p>
<p><em><strong>bulk download</strong></em></p>
<p>Link to bulk download of dataset: passed at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress?f=json">/collections/collection level</a> and at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections?f=json">/collections level</a>. </p>
<p><code>{"href":"http://test.haleconnect.de/ogcapi/datasets/simplified-addresses/collections/SimpleAddress/items?bulk=true","rel":"enclosure","type":"application/xml","title":"Download all features as GML"}</code> 
<code>{"href":"http://test.haleconnect.de/ogcapi/datasets/simplified-addresses/collections/SimpleAddress/items?bulk=true","rel":"enclosure","type":"application/json","title":"Download all features as GeoJSON"}</code> </p>
<p><em><strong>GeoJSON</strong></em></p>
<p>Items can be retrieved in GeoJSON by requesting:  </p>
<p><code>https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/collections/SimpleAddress/items?f=json&amp;limit=1</code></p>
<p> or</p>
<p><code>https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/collections/SimpleAddress/items/nl-imbag-ad-address-0003200000133985?f=json</code></p>
<p><em><strong>GML</strong></em> </p>
<p>As input, a simple features GML file was used as produced by Wetransform from the complex feature GML with the transformation software Hale.
As output, the following links can be found at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections/SimpleAddress?f=json">/collections/collection level</a>. They can be used to download specific records.</p>
<p><code>{"href":"http://test.haleconnect.de/ogcapi/datasets/simplified-addresses/collections/SimpleAddress/items?bulk=true","rel":"enclosure","type":"application/xml","title":"Download all features as GML"}</code> </p>
<p>or </p>
<p><code>{"href":"http://test.haleconnect.de/ogcapi/datasets/simplified-addresses/collections/SimpleAddress/items","rel":"items","type":"application/gml+xml;version=3.2","title":"Features as GML"}</code></p>
<p>(use parameter <code>f=xml</code>)</p>
<p><em><strong>Describing encoding</strong></em>  </p>
<p>There is a link to <a href="https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/ads">https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/ads</a> at <a href="https://test.haleconnect.de/ogcapi/datasets/simplified-addresses/v1/collections?f=json">/collections/collection level</a>. </p>
<p><code>{"href":"https://github.com/INSPIRE-MIF/2017.2/tree/master/GeoJSON/ads","rel":"describedby","type":"text/html","title":"Encoding description"}</code></p>
</section><section id="other-findings-on-deegree"><div class="header-wrapper"><h4 id="x4-3-5-other-findings-on-deegree"><bdi class="secno">4.3.5 </bdi>Other findings on Deegree</h4><a class="self-link" href="#other-findings-on-deegree" aria-label="Permalink for Section 4.3.5"></a></div>
<p>More information about the Deegree adjustments to the standards can be found at <a href="https://www.geonovum.nl/uploads/documents/deegree%20OGC%20API%20Features.pdf">https://www.geonovum.nl/uploads/documents/deegree%20OGC%20API%20Features.pdf</a></p>
</section></section><section id="general-findings"><div class="header-wrapper"><h3 id="x4-4-general-findings"><bdi class="secno">4.4 </bdi>General findings</h3><a class="self-link" href="#general-findings" aria-label="Permalink for Section 4.4"></a></div>
<ol>
<li>There has been discussion whether the predefined download links should be at collections or collections/collection level. See also: <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/issues/91">https://github.com/INSPIRE-MIF/gp-ogc-api-features/issues/91</a>.<br>During the project of adjusting the tools we had the opinion that both should be possible.<br>Afterwards, we found out that it should be at collections level since it is one of the <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md#main-principles">main principles</a> in [PUB-2] to use one data set in one API.</li>
<li>The protocol element in the metadata is based on a code list. A new protocol needs to be added to this list of <a href="https://inspire.ec.europa.eu/metadata-codelist/ProtocolValue:1">protocol values</a>.
As long as it is not there, the Dutch profile for metadata can be used with the value: "OGC:API features" <a href="https://geonovum.github.io/Metadata-ISO19119/#codelist-protocol">https://geonovum.github.io/Metadata-ISO19119/#codelist-protocol</a>.</li>
<li>Another blocking issue before implementation of the OAPIF for INSPIRE is that descriptions of encodings other than GML are not yet available for most INSPIRE themes.</li>
<li>Complex GML as input and output are difficult as long as tooling (server and client) expects simple encodings.</li>
<li>One could discuss if it is useful to publish complex GML as output, because it is not in line with the aim of OGI API Features: easy to use for developers.</li>
<li>Complex GML as input needs a flattening of the data. This is needed for the software that publishes the features. It can only work with simple features, with one value per attribute and without relations to other objects.
This is often not the case with the more complex INSPIRE models.</li>
</ol>
</section><section id="resulting-documentation"><div class="header-wrapper"><h3 id="x4-5-resulting-documentation"><bdi class="secno">4.5 </bdi>Resulting documentation</h3><a class="self-link" href="#resulting-documentation" aria-label="Permalink for Section 4.5"></a></div>
<p>Presentations can be found here: <a href="https://www.geonovum.nl/over-geonovum/actueel/presentatie-resultaten-aanbesteding-ogc-api-features-toolaanpassing">https://www.geonovum.nl/over-geonovum/actueel/presentatie-resultaten-aanbesteding-ogc-api-features-toolaanpassing</a></p>
</section></section>
  
  <section id="references" class="appendix"><div class="header-wrapper"><h2 id="a-references"><bdi class="secno">A. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></div><section id="informative-references">
    <div class="header-wrapper"><h3 id="a-1-informative-references"><bdi class="secno">A.1 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix A.1"></a></div>
    <dl class="bibliography"><dt id="bib-pub-1">[PUB-1]</dt><dd>
      <a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html"><cite>OGC API Features Part1:Core</cite></a>.  OGC. V1.0. URL: <a href="https://docs.opengeospatial.org/is/17-069r4/17-069r4.html">https://docs.opengeospatial.org/is/17-069r4/17-069r4.html</a>
    </dd><dt id="bib-pub-2">[PUB-2]</dt><dd>
      <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md"><cite>Setting up an INSPIRE Download service based on the OGC API-Features standard</cite></a>.  INSPIRE-MIF. V1.0. URL: <a href="https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md">https://github.com/INSPIRE-MIF/gp-ogc-api-features/blob/master/spec/oapif-inspire-download.md</a>
    </dd><dt id="bib-pub-3">[PUB-3]</dt><dd>
      <a href="https://www.geonovum.nl/over-geonovum/actueel/rest-api-design-rules-op-pas-toe-leg-uit-lijst"><cite>Dutch API design rules</cite></a>.  https://www.geonovum.nl. 19 JULI 2020. URL: <a href="https://www.geonovum.nl/over-geonovum/actueel/rest-api-design-rules-op-pas-toe-leg-uit-lijst">https://www.geonovum.nl/over-geonovum/actueel/rest-api-design-rules-op-pas-toe-leg-uit-lijst</a>
    </dd><dt id="bib-pub-4">[PUB-4]</dt><dd>
      <a href="https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/geojson-encoding-rule.md#inspire-requirements-for-encoding-rules"><cite>INSPIRE UML-to-GeoJSON encoding rule</cite></a>.  Working group on Inspire Action 2017.2. V0.1. URL: <a href="https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/geojson-encoding-rule.md#inspire-requirements-for-encoding-rules">https://github.com/INSPIRE-MIF/2017.2/blob/master/GeoJSON/geojson-encoding-rule.md#inspire-requirements-for-encoding-rules</a>
    </dd><dt id="bib-pub-5">[PUB-5]</dt><dd>
      <a href="http://docs.opengeospatial.org/is/18-058r1/18-058r1.html"><cite>OGC API - Features - Part 2: Coordinate Reference Systems by Reference</cite></a>.  OGC. V1.0. URL: <a href="http://docs.opengeospatial.org/is/18-058r1/18-058r1.html">http://docs.opengeospatial.org/is/18-058r1/18-058r1.html</a>
    </dd><dt id="bib-pub-6">[PUB-6]</dt><dd>
      <a href="https://docs.ogc.org/DRAFTS/19-079r1.html"><cite>OGC API - Features - Part 3: Filtering and the Common Query Language (CQL)</cite></a>.  OGC. V1.0.0, draft. URL: <a href="https://docs.ogc.org/DRAFTS/19-079r1.html">https://docs.ogc.org/DRAFTS/19-079r1.html</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><div class="sidelabel">Geonovum Guide - Editor's draft</div><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>